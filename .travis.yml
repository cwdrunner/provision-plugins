dist: xenial
language: go
addons:
  apt:
    packages:
    - bsdtar
go:
- '1.13'
git:
  depth: 500
sudo: false
before_install:
- echo -e "machine github.com\n  login $CI_USER_TOKEN" > ~/.netrc
install:
- "./tools/build.sh"
script:
- curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
- unzip awscli-bundle.zip
- "./awscli-bundle/install -b ~/bin/aws"
- "./tools/test.sh"
- "./tools/build_rel_notes.sh"
- "./tools/publish.sh"
after_script:
- tools/notify.sh digitalrebar/provision-plugins
notifications:
  slack:
    secure: Imuptg78FWWZlGVb8LBuwn45CeMfnHgf+pXbftR8mSGFRsg08jw38MIRtw/MAET3RJsciwDXf22AkgM8WgZ+fcUbJI4MGn2IvnM40T/imc5deqlMn1QdE5HasWrrBwfyY7hDu8XBexit+2fmYLGGrHX2fsbvUJepT4xOV8MZbZWMYueoBuL2bxNRR+lhjqVsKMq+/8q4g7hsKxYOdStEOZQIM13qI8dbIIQK4cCPQGtdNMGlNSX0a/nEFZmxDKh3WILssZcRst7SW3QldYppJO21PcTmY/zCTLJ5b7izweLczDmV77ckv61X50B8iaarhwEMFYs9Icg8U69mAkbqeU5HsWy1d2VDPDG+QW32VMTU371pVEzsmBVzArSXvldULmRzYcA+9LoYb5P6LNbq2y7tdimETOElbkMyw53hnb4ZPiypLWlwusZibCxGsJMp41MgbxxaMKxUgrBsAY9nSBg/oj7ixditveXm5IjqBJXfFyxuxfvcxssT15AiqFI3z+Mpoarq233V7E/c0AwdYc/iJKPtW8DG2uSjb0EMIKopXjEi/tz8ykVQH1UbKww5PvGfzCw2mCNF+Bc925coTs8gwaU+XOnqQesggUheAmpaQhbdPGpNYecbLgtQ3kafEBllTrgLyTqISkXlDMZybItP1C8GrEEshGWSEzBAEGU=
env:
  global:
    secure: LqGvNMznkFjZDWmpms1tSMu/bmPkD0zMUJZXNCj4Mf4nqZP+Ds/JOwu/CWMNyPl+RZskeFiuoaZjQm4cZ4km+5GPl1uPDV/NgTJjoo5FmCDR5cD3sCBeUggom9JG7sksDBI4LFtNHFba+Xc4hIRZzEntFhasnLZcauq8UHYZrMnNvn3ogWJa12ExfqKM5EIbVtuO/g8um4C4dk0qHs+RknjZYzvaBMiDAEK2vTOLDWkyGl/DJWPNu7iEfqG4YktwLn0HP4gdLq9zMBJI9rOEP0/z5yB6yeUUxzS8qhS1IkvgKALKdtUvdpnc9YJRQniqQ8hWvZGTEz+7DBTHdKWF2DDpJqT/km+A4gn2qdf1/oanQ9F5Kv52i25CPH8QEh4fFkvr0H9u3ZV8I1CzY+B2f5y/n4ywD04SGdYm31MDBK2mGeB9Q4Tl/ikjMg/76p6V7p9du8qy5uqcrAft9+SOk6hFw8yGTrXfvl0hltqJYjOcn1oH2CTYuu142JDWLRztIfl3JwPmQlgnNf0xKZVHxq6ObqQGVdlA6AsT7jOf05osnlXF3Ors8l/8NZgPhzKYnoyTBUf5AxgzSEwdOgw2mU5/8to8YZXp0iRzv4d3m/Tm7vcfc4MPMmlOQ8RrcRhTNb9omJm2inJp5YDhS7+Y9awqBlxAi6alIJRWkgyV2T0=
deploy:
- provider: s3
  access_key_id: AKIAJY25W4N3CA7NRHJQ
  secret_access_key:
    secure: Gg+gBFheRNLy42CGuGlLvG+r57ReP48gP8xnbXNw22d9sVgsRAAoZUgsA+jRK00lhwRLsW6oRxJqF/y49+OGCgh85fm+2xus/M+gXR0gFOeditRx6l0F6mk6yqyd8ZAA9s/2DG7gXOSzWfmyxpzKkIVrkvkrJBhSSK/AvZWoORQCQpLKEq5Bga7erD+Qg9As37J4f02P0fwae4Mf15rlfzWWp+fFOLmLeboEzREvXKeW7bcMDCqFfqHQofQwIYmyBkJROCLystJu3A3dGZrqAD+iT72Jowy6/ZntInrOaTCFP8LqgcuXgS3Qewyywyq45RjlkiyDw5QDq5fTYPpu5sCUlcwoBB26ZeYRyqeapZZ967VSQ72f0bvK9lp1cgquoexLDjLp3iGDkjcV0ombbGgAPIfpziNNVInXtttk1Mz2iDKQIP+ryZGeRRqdyB9YMCDFaEXU8EWDDApS5kZgiHDzHnXe4xM6JlKczFhG1jSpksXCJ8JevlIYKjHnPEszbhy++eGMP3i8fSr2CYioKimoudNYp08VITy+xAX6HGZu6Q4CsLgNy8t3fHjfsG+7l/R+0k5iVHTRIwyJoGzFy0q+Qx+c8M8BN0/1le78ZukLIUNlvtm5lvgmTTZbBW4+qGtuAI69mo0bHCwRgqgJk26PMND087TZlyqcrJylYQY=
  bucket: rebar-catalog
  region: us-west-2
  local-dir: rebar-catalog
  acl: public_read
  skip_cleanup: true
  on:
    repo: digitalrebar/provision-plugins
    branch: v4
- provider: s3
  access_key_id: AKIAJY25W4N3CA7NRHJQ
  secret_access_key:
    secure: Gg+gBFheRNLy42CGuGlLvG+r57ReP48gP8xnbXNw22d9sVgsRAAoZUgsA+jRK00lhwRLsW6oRxJqF/y49+OGCgh85fm+2xus/M+gXR0gFOeditRx6l0F6mk6yqyd8ZAA9s/2DG7gXOSzWfmyxpzKkIVrkvkrJBhSSK/AvZWoORQCQpLKEq5Bga7erD+Qg9As37J4f02P0fwae4Mf15rlfzWWp+fFOLmLeboEzREvXKeW7bcMDCqFfqHQofQwIYmyBkJROCLystJu3A3dGZrqAD+iT72Jowy6/ZntInrOaTCFP8LqgcuXgS3Qewyywyq45RjlkiyDw5QDq5fTYPpu5sCUlcwoBB26ZeYRyqeapZZ967VSQ72f0bvK9lp1cgquoexLDjLp3iGDkjcV0ombbGgAPIfpziNNVInXtttk1Mz2iDKQIP+ryZGeRRqdyB9YMCDFaEXU8EWDDApS5kZgiHDzHnXe4xM6JlKczFhG1jSpksXCJ8JevlIYKjHnPEszbhy++eGMP3i8fSr2CYioKimoudNYp08VITy+xAX6HGZu6Q4CsLgNy8t3fHjfsG+7l/R+0k5iVHTRIwyJoGzFy0q+Qx+c8M8BN0/1le78ZukLIUNlvtm5lvgmTTZbBW4+qGtuAI69mo0bHCwRgqgJk26PMND087TZlyqcrJylYQY=
  bucket: rebar-catalog
  region: us-west-2
  local-dir: rebar-catalog
  acl: public_read
  skip_cleanup: true
  on:
    repo: digitalrebar/provision-plugins
    tags: true
